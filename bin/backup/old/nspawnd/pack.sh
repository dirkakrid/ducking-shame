#!/bin/env bash
##########################################################################################################################################################################################
function usage {
cat << EOF
${0} - help
-r rootfs    - takes rootfs    tarballs it, encrypts produces key, signs the tarball encrypts the key using /mnt/container/gnupg
-r overlayfs - takes overlayfs tarballs it, encrypts produces key, detached sign the tarball encrypts the key using /mnt/container/gnupg
encrypted images stored in rawfs
encryption keys stored in keys
EOF
if [[ ${2} ]];then printf "%s\n" "${2}";fi
exit ${1}
}
##########################################################################################################################################################################################
#DEFAULTS
##########################################################################################################################################################################################
while getopts 'r:o:h' arg;do
case "${arg}" in
  r)
    ROOTFS="${OPTARG}"
    ROOTFS_+="${ROOTFS}"
  ;;
  o)
    OVERLAYFS="${ROOTFS}.${OTARG}"
    OVERLAYFS_+="${OVERLAYFS}"
  ;;
  h) usage 0;;
  *) usage 1;;
esac
done
##########################################################################################################################################################################################
function debuggery {
cat << EOF
debuggery...
EOF
}
##########################################################################################################################################################################################
if [[ ! -z ${ROOTFS} && ! -z ${OVERLAYFS} ]];then
##########################################################################################################################################################################################
elif [[ ! -z ${ROOTFS} && -z ${OVERLAYFS} ]];then
##########################################################################################################################################################################################
else usage 1 "no input";fi
##########################################################################################################################################################################################

